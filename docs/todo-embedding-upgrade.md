# 임베딩 시스템 업그레이드 TODO 리스트

**생성일**: 2025-08-20  
**현재 상태**: Phase 1 준비 중  

## 🎯 Phase 1: 핵심 임베딩 엔진 교체

### 환경 준비
- [ ] 새로운 의존성 라이브러리 설치
  - [ ] FlagEmbedding>=1.2.0
  - [ ] rank-bm25>=0.2.2  
  - [ ] networkx>=3.0
  - [ ] tiktoken>=0.5.0
- [ ] requirements.txt 업데이트

### BGE-M3 모델 통합
- [ ] FlagEmbedding 라이브러리 테스트 및 임포트 확인
- [ ] BGE-M3 모델 다운로드 및 초기화 테스트
- [ ] GPU 사용 가능 여부 확인 및 설정
- [ ] 모델 캐싱 디렉토리 설정

### SentenceTransformerEngine 재작성
- [ ] 기존 TF-IDF 코드 백업 (git으로 관리됨)
- [ ] AdvancedEmbeddingEngine 클래스 설계
- [ ] 다중 임베딩 지원 구조 구현
  - [ ] Dense embeddings (의미적 검색)
  - [ ] Sparse embeddings (키워드 검색)  
  - [ ] ColBERT embeddings (토큰 수준)
- [ ] 기존 인터페이스 호환성 유지
- [ ] 임베딩 캐시 시스템 연동

### 기본 기능 테스트
- [ ] 단일 텍스트 임베딩 생성 테스트
- [ ] 배치 텍스트 임베딩 생성 테스트
- [ ] 유사도 계산 정확성 검증
- [ ] 메모리 사용량 모니터링

## 🔍 Phase 2: Hybrid Search 구현

### BM25 통합
- [ ] BM25Okapi 모델 초기화
- [ ] 기존 문서 인덱싱을 BM25로 확장
- [ ] 키워드 기반 검색 성능 테스트

### 결과 융합 시스템
- [ ] RRF (Reciprocal Rank Fusion) 알고리즘 구현
- [ ] Dense/Sparse 검색 가중치 조정 시스템
- [ ] 하이브리드 검색 결과 평가

### 검색 인터페이스 업데이트  
- [ ] AdvancedSearchEngine 클래스 수정
- [ ] hybrid_search() 메서드 구현
- [ ] 기존 semantic_search(), keyword_search() 메서드 업데이트

## 🎯 Phase 3: Reranking 시스템 추가

### Cross-encoder 모델 통합
- [ ] BGE-reranker-v2-m3 모델 로드
- [ ] Reranking 파이프라인 구현
- [ ] 2단계 검색 시스템 구축 (retrieve → rerank)

### 성능 최적화
- [ ] Top-k 후보 추출 최적화 (k=100)
- [ ] Reranking 배치 처리 구현
- [ ] 메모리 효율성 개선

## 🔧 Phase 4: Obsidian 특화 기능

### 링크 그래프 분석
- [ ] NetworkX를 사용한 문서 관계 분석
- [ ] PageRank 알고리즘으로 문서 중요도 계산
- [ ] 링크 기반 검색 점수 부스팅

### 메타데이터 활용
- [ ] 태그 매칭 시 가중치 증가 시스템
- [ ] 폴더 계층 구조 반영
- [ ] 생성일/수정일 기반 시간적 관련성

### 문서 전처리 개선
- [ ] 마크다운 파싱 강화
- [ ] 코드 블록 별도 처리
- [ ] 헤더 기반 청킹 전략 구현

## ✅ 테스트 및 검증

### 성능 테스트
- [ ] 검색 정확도 측정 (Precision@K, Recall@K)
- [ ] 기존 TF-IDF 대비 성능 비교
- [ ] 검색 속도 벤치마크
- [ ] 메모리 사용량 프로파일링

### 기능 테스트
- [ ] 한국어 검색 성능 검증
- [ ] 긴 문서 처리 테스트 (8192 토큰)
- [ ] 중복 감지 정확도 테스트
- [ ] 주제별 클러스터링 품질 평가

### 통합 테스트
- [ ] CLI 명령어 전체 테스트
- [ ] 기존 캐시 마이그레이션 테스트
- [ ] 오류 처리 및 예외 상황 대응

## 📚 문서화

### 코드 문서화
- [ ] 새로운 클래스 및 메서드 docstring 작성
- [ ] README.md 업데이트
- [ ] CLAUDE.md에 새로운 기능 추가

### 사용자 가이드
- [ ] 모델 선택 가이드 작성
- [ ] 성능 튜닝 가이드 작성
- [ ] 마이그레이션 가이드 작성

## 🚀 배포 및 마무리

### 설정 파일 업데이트
- [ ] config/settings.yaml에 새로운 모델 설정 추가
- [ ] 기본값을 BGE-M3로 변경
- [ ] 성능 관련 설정 최적화

### 마무리 작업
- [ ] 사용하지 않는 TF-IDF 관련 코드 정리
- [ ] 최종 통합 테스트 실행
- [ ] Git 커밋 및 태그 생성

---

## 📊 진행 상황

**전체 진행률**: 0% (0/60개 항목 완료)

### Phase별 진행률
- **Phase 1**: 0% (0/16개)  
- **Phase 2**: 0% (0/8개)
- **Phase 3**: 0% (0/6개)  
- **Phase 4**: 0% (0/11개)
- **테스트**: 0% (0/11개)
- **문서화**: 0% (0/5개)
- **배포**: 0% (0/3개)

---

**다음 작업**: 새로운 의존성 라이브러리 설치부터 시작