# Vault Intelligence System V2 Configuration

# 모델 설정
model:
  name: "BAAI/bge-m3"
  dimension: 1024
  batch_size: 8 # 성능 최대화: MPS 가속과 함께 처리량 8배 증가
  cache_folder: "models/"
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  use_fp16: false # M1 Pro CPU에서는 FP16 비활성화
  max_length: 4096 # 정확도 향상: 더 긴 문맥 지원으로 검색 품질 개선
  num_workers: 6 # 성능 최적화: M1 Pro 10코어의 60% 활용

# 캐시 설정
cache:
  db_path: "cache/embeddings.db"
  metadata_path: "cache/metadata.json"
  enable_compression: true
  clean_on_start: false

# Vault 설정
vault:
  excluded_dirs:
    - ".DS_Store"
    - ".claude"
    - ".git"
    - ".idea"
    - ".obsidian-tools"
    - ".obsidian"
    - ".serena"
    - ".smart-env"
    - ".smtcmp_chat_histories"
    - ".smtcmp_json_db"
    - ".trash"
    - "cc-logs"
    - "smart-chats"
    - "Excalidraw"
    - "Template"
    - "DATA-VIEW"
    - "WIP"
    - "ATTACHMENTS"
    - "FONTS"
  excluded_files:
    - ".DS_Store"
    - "Thumbs.db"
    - "desktop.ini"
    - "*.tmp"
    - "*.temp"
    - "*.backup"
    - "*.bak"
    - "*.log"
    - "*~"
    - ".gitignore"
    - ".gitkeep"
    - "README.md" # 원하지 않는 경우
    - "CLAUDE.md" # 원하지 않는 경우
    - "LICENSE*"
    - "CHANGELOG*"
  file_extensions:
    - ".md"
    - ".markdown"
  max_file_size_mb: 10

# 검색 설정
search:
  default_top_k: 10
  similarity_threshold: 0.3
  enable_hybrid_search: true
  text_weight: 0.3
  semantic_weight: 0.7

# Reranker 설정 (Phase 5.1)
reranker:
  model_name: "BAAI/bge-reranker-v2-m3"
  use_fp16: true
  cache_folder: "models/"
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  batch_size: 4
  initial_candidates_multiplier: 3 # 초기 검색에서 final_k * 3개 후보 검색

# ColBERT 설정 (Phase 5.2 + 증분 인덱싱)
colbert:
  model_name: "BAAI/bge-m3" # BGE-M3 ColBERT 기능 사용
  use_fp16: true
  cache_folder: "models/"
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  max_length: 4096
  batch_size: 8 # 캐싱으로 배치 크기 증가 가능
  max_documents: null # 전체 문서 대상 (제한 없음)
  enable_cache: true # ColBERT 캐싱 활성화
  incremental_indexing: true # 증분 인덱싱 활성화
  auto_index_on_reindex: true # reindex 시 자동 ColBERT 인덱싱

# 쿼리 확장 설정 (Phase 5.3)
query_expansion:
  model_name: "BAAI/bge-m3" # BGE-M3 모델 사용
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  use_fp16: true
  enable_hyde: true # HyDE (Hypothetical Document Embeddings) 활성화
  max_synonyms: 3 # 최대 동의어 수
  synonym_weight: 0.8 # 동의어 검색 결과 가중치
  hyde_weight: 0.6 # HyDE 검색 결과 가중치

# 중복 감지 설정
duplicates:
  similarity_threshold: 0.85
  min_word_count: 50
  group_threshold: 0.9

# 클러스터링 설정 (Phase 9)
clustering:
  default_algorithm: "kmeans"           # 기본 알고리즘 (kmeans, dbscan, agglomerative)
  auto_k: true                          # 최적 클러스터 수 자동 결정
  default_n_clusters: 15                # 수동 설정시 기본 클러스터 수
  min_cluster_size: 2                   # 최소 클러스터 크기
  max_clusters: 20                      # 최대 클러스터 수
  silhouette_threshold: 0.5             # 실루엣 점수 최소 임계값
  random_state: 42                      # 재현성을 위한 랜덤 시드
  
  # K-means 설정
  kmeans:
    n_init: 10                          # 초기화 횟수
    max_iter: 300                       # 최대 반복 횟수
    tol: 1e-4                          # 수렴 허용 오차
  
  # DBSCAN 설정  
  dbscan:
    eps: 0.5                           # 이웃 반경
    min_samples: 5                     # 핵심 포인트 최소 샘플 수
    
  # Agglomerative 설정
  agglomerative:
    linkage: "ward"                    # 연결 기준 (ward, complete, average, single)

# 문서 요약 설정 (Phase 9)
document_summarization:
  default_style: "detailed"            # 기본 요약 스타일 (brief, detailed, technical, conceptual)
  max_documents_per_cluster: 50        # 클러스터당 최대 문서 수
  max_content_length: 8000             # 요약할 최대 콘텐츠 길이
  hierarchical_summary: true           # 계층적 요약 활성화
  include_keywords: true               # 키워드 포함 여부
  include_representative_doc: true     # 대표 문서 포함 여부
  
  # Claude Code LLM 연동 설정
  claude_code_integration:
    subagent_type: "general-purpose"   # 사용할 에이전트 타입
    max_retries: 3                     # 최대 재시도 횟수
    timeout: 300                       # 타임아웃 (초)
    chunk_size: 4000                   # 청크 크기
    overlap_size: 200                  # 청크 간 오버랩 크기
  
  # 요약 스타일별 설정
  styles:
    brief:
      max_sentences: 3                 # 최대 문장 수
      focus: "key_points"             # 핵심 포인트 중심
    detailed:
      max_sentences: 10               # 최대 문장 수  
      focus: "comprehensive"          # 포괄적 요약
    technical:
      max_sentences: 8                # 최대 문장 수
      focus: "technical_details"      # 기술적 세부사항 중심
    conceptual:
      max_sentences: 6                # 최대 문장 수
      focus: "concepts_and_principles" # 개념과 원칙 중심

# 학습 리뷰 설정 (Phase 9)
learning_review:
  default_period: "weekly"             # 기본 리뷰 기간 (weekly, monthly, quarterly)
  include_activity_stats: true        # 활동 통계 포함
  include_topic_analysis: true        # 주제별 분석 포함
  include_progress_tracking: true     # 진전도 추적 포함
  include_recommendations: true       # 추천사항 포함
  
  # 기간별 설정
  periods:
    weekly:
      min_documents: 3                # 최소 문서 수
      activity_weight: 0.6           # 활동량 가중치
      growth_weight: 0.4             # 성장률 가중치
    monthly:
      min_documents: 10              # 최소 문서 수
      activity_weight: 0.4           # 활동량 가중치
      growth_weight: 0.6             # 성장률 가중치
    quarterly:
      min_documents: 30              # 최소 문서 수
      activity_weight: 0.3           # 활동량 가중치
      growth_weight: 0.7             # 성장률 가중치
  
  # 진전도 측정 설정
  progress_tracking:
    min_topic_documents: 5            # 주제별 최소 문서 수
    growth_calculation_method: "exponential" # 성장률 계산 방법
    benchmark_period_days: 30         # 벤치마크 기간 (일)
    significance_threshold: 0.1       # 유의미한 변화 임계값

# 주제 수집 설정
collection:
  min_documents: 3
  group_by_tags: true
  include_statistics: true
  output_format: "markdown"

# 로깅 설정
logging:
  level: "ERROR" # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: null # null=console only, 또는 파일 경로

# 성능 설정
performance:
  enable_gpu: true
  num_workers: 8 # 워커 수 증가
  chunk_size: 200 # 청크 크기 감소로 더 세밀한 처리
  progress_bar: true

# 지식 그래프 설정 (Phase 6)
knowledge_graph:
  similarity_threshold: 0.4      # 문서 간 연결 임계값
  min_word_count: 50            # 분석 대상 최소 단어 수
  centrality_weight: 0.2        # 중심성 점수 가중치
  max_connections_per_doc: 50   # 문서당 최대 연결 수
  enable_tag_nodes: true        # 태그 노드 포함 여부
  community_algorithm: "louvain" # 커뮤니티 감지 알고리즘

# 관련 문서 추천 설정
related_docs:
  similarity_threshold: 0.3     # 관련성 최소 임계값
  tag_similarity_weight: 0.3    # 태그 유사도 가중치
  semantic_similarity_weight: 0.5 # 의미적 유사도 가중치
  centrality_boost_weight: 0.2  # 중심성 가중치
  max_candidates: 100           # 최대 후보 문서 수

# 지식 공백 분석 설정
gap_analysis:
  min_connections: 3            # 고립 판정 최소 연결 수
  centrality_threshold: 0.1     # 중심성 최소 임계값
  isolation_threshold: 0.2      # 고립도 임계값

# 의미적 태깅 설정 (Phase 7)
semantic_tagging:
  model_name: "BAAI/bge-m3"
  device: "mps"                 # M1 Pro Metal Performance Shaders 가속
  use_fp16: true
  batch_size: 4                 # 태깅 배치 크기
  max_length: 4096              # 최대 토큰 길이
  
  # 태그 생성 규칙
  rules_file: "~/dotfiles/.claude/commands/obsidian/add-tag.md"
  max_tags_per_document: 10     # 문서당 최대 태그 수 (기존 6개 → 확장)
  min_semantic_similarity: 0.3  # 의미적 유사도 최소 임계값
  
  # 카테고리별 태그 제한
  max_topic_tags: 4             # 주제 태그 최대 수
  max_pattern_tags: 3           # 패턴 태그 최대 수  
  max_framework_tags: 2         # 프레임워크 태그 최대 수
  max_source_tags: 1            # 출처 태그 최대 수
  max_doctype_tags: 1           # 문서 유형 태그 최대 수
  
  # 기존 태그 학습 설정
  learn_from_existing: true     # 기존 vault 태그 패턴 학습 여부
  similarity_threshold_for_learning: 0.7  # 태그 학습 유사도 임계값
  ignore_existing_tags: true    # 기존 태그 무시하고 재생성
  
  # 태그 정규화 규칙
  force_lowercase: true         # 소문자 강제 변환
  replace_spaces_with_hyphens: true  # 공백을 하이픈으로 변환
  remove_development_prefix: true    # development/ prefix 제거
  exclude_directory_based_tags: true # 디렉토리 기반 태그 제외
  use_hierarchical_separator: "/"   # 계층 구분자
  
  # 배치 처리 설정
  enable_recursive: true        # 재귀 처리 기본값
  default_batch_size: 10        # 기본 배치 크기
  show_progress: true           # 진행률 표시
  enable_dry_run: false         # 드라이런 모드 기본값
  
  # 품질 검증 설정
  validate_tag_consistency: true    # 태그 일관성 검증
  min_confidence_score: 0.5         # 최소 신뢰도 점수
  enable_tag_deduplication: true    # 태그 중복 제거
  
  # 성능 최적화
  cache_semantic_analysis: true     # 의미 분석 결과 캐싱
  parallel_processing: true         # 병렬 처리 활성화
  memory_limit_mb: 2048            # 메모리 제한 (MB)
