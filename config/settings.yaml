# Vault Intelligence System V2 Configuration

# 모델 설정
model:
  name: "BAAI/bge-m3"
  dimension: 1024
  batch_size: 8 # 성능 최대화: MPS 가속과 함께 처리량 8배 증가
  cache_folder: "models/"
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  use_fp16: false # M1 Pro CPU에서는 FP16 비활성화
  max_length: 4096 # 정확도 향상: 더 긴 문맥 지원으로 검색 품질 개선
  num_workers: 6 # 성능 최적화: M1 Pro 10코어의 60% 활용

# 캐시 설정
cache:
  db_path: "cache/embeddings.db"
  metadata_path: "cache/metadata.json"
  enable_compression: true
  clean_on_start: false

# Vault 설정
vault:
  excluded_dirs:
    - ".DS_Store"
    - ".claude"
    - ".git"
    - ".idea"
    - ".obsidian-tools"
    - ".obsidian"
    - ".serena"
    - ".smart-env"
    - ".smtcmp_chat_histories"
    - ".smtcmp_json_db"
    - ".trash"
    - "cc-logs"
    - "smart-chats"
    - "Excalidraw"
    - "Template"
    - "DATA-VIEW"
    - "WIP"
    - "ATTACHMENTS"
    - "FONTS"
  excluded_files:
    - ".DS_Store"
    - "Thumbs.db"
    - "desktop.ini"
    - "*.tmp"
    - "*.temp"
    - "*.backup"
    - "*.bak"
    - "*.log"
    - "*~"
    - ".gitignore"
    - ".gitkeep"
    - "README.md" # 원하지 않는 경우
    - "CLAUDE.md" # 원하지 않는 경우
    - "LICENSE*"
    - "CHANGELOG*"
  file_extensions:
    - ".md"
    - ".markdown"
  max_file_size_mb: 10

# 검색 설정
search:
  default_top_k: 10
  similarity_threshold: 0.3
  enable_hybrid_search: true
  text_weight: 0.3
  semantic_weight: 0.7

# Reranker 설정 (Phase 5.1)
reranker:
  model_name: "BAAI/bge-reranker-v2-m3"
  use_fp16: true
  cache_folder: "models/"
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  batch_size: 4
  initial_candidates_multiplier: 3 # 초기 검색에서 final_k * 3개 후보 검색

# ColBERT 설정 (Phase 5.2 + 증분 인덱싱)
colbert:
  model_name: "BAAI/bge-m3" # BGE-M3 ColBERT 기능 사용
  use_fp16: true
  cache_folder: "models/"
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  max_length: 4096
  batch_size: 8 # 캐싱으로 배치 크기 증가 가능
  max_documents: null # 전체 문서 대상 (제한 없음)
  enable_cache: true # ColBERT 캐싱 활성화
  incremental_indexing: true # 증분 인덱싱 활성화
  auto_index_on_reindex: true # reindex 시 자동 ColBERT 인덱싱

# 쿼리 확장 설정 (Phase 5.3)
query_expansion:
  model_name: "BAAI/bge-m3" # BGE-M3 모델 사용
  device: "mps" # M1 Pro Metal Performance Shaders 가속
  use_fp16: true
  enable_hyde: true # HyDE (Hypothetical Document Embeddings) 활성화
  max_synonyms: 3 # 최대 동의어 수
  synonym_weight: 0.8 # 동의어 검색 결과 가중치
  hyde_weight: 0.6 # HyDE 검색 결과 가중치

# 중복 감지 설정
duplicates:
  similarity_threshold: 0.85
  min_word_count: 50
  group_threshold: 0.9

# 클러스터링 설정
clustering:
  default_n_clusters: 15
  min_cluster_size: 3
  algorithm: "kmeans" # "kmeans", "dbscan", "hierarchical"
  random_state: 42

# 주제 수집 설정
collection:
  min_documents: 3
  group_by_tags: true
  include_statistics: true
  output_format: "markdown"

# 로깅 설정
logging:
  level: "ERROR" # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: null # null=console only, 또는 파일 경로

# 성능 설정
performance:
  enable_gpu: true
  num_workers: 8 # 워커 수 증가
  chunk_size: 200 # 청크 크기 감소로 더 세밀한 처리
  progress_bar: true

# 지식 그래프 설정 (Phase 6)
knowledge_graph:
  similarity_threshold: 0.4      # 문서 간 연결 임계값
  min_word_count: 50            # 분석 대상 최소 단어 수
  centrality_weight: 0.2        # 중심성 점수 가중치
  max_connections_per_doc: 50   # 문서당 최대 연결 수
  enable_tag_nodes: true        # 태그 노드 포함 여부
  community_algorithm: "louvain" # 커뮤니티 감지 알고리즘

# 관련 문서 추천 설정
related_docs:
  similarity_threshold: 0.3     # 관련성 최소 임계값
  tag_similarity_weight: 0.3    # 태그 유사도 가중치
  semantic_similarity_weight: 0.5 # 의미적 유사도 가중치
  centrality_boost_weight: 0.2  # 중심성 가중치
  max_candidates: 100           # 최대 후보 문서 수

# 지식 공백 분석 설정
gap_analysis:
  min_connections: 3            # 고립 판정 최소 연결 수
  centrality_threshold: 0.1     # 중심성 최소 임계값
  isolation_threshold: 0.2      # 고립도 임계값

# 의미적 태깅 설정 (Phase 7)
semantic_tagging:
  model_name: "BAAI/bge-m3"
  device: "mps"                 # M1 Pro Metal Performance Shaders 가속
  use_fp16: true
  batch_size: 4                 # 태깅 배치 크기
  max_length: 4096              # 최대 토큰 길이
  
  # 태그 생성 규칙
  rules_file: "~/dotfiles/.claude/commands/obsidian/add-tag.md"
  max_tags_per_document: 10     # 문서당 최대 태그 수 (기존 6개 → 확장)
  min_semantic_similarity: 0.3  # 의미적 유사도 최소 임계값
  
  # 카테고리별 태그 제한
  max_topic_tags: 4             # 주제 태그 최대 수
  max_pattern_tags: 3           # 패턴 태그 최대 수  
  max_framework_tags: 2         # 프레임워크 태그 최대 수
  max_source_tags: 1            # 출처 태그 최대 수
  max_doctype_tags: 1           # 문서 유형 태그 최대 수
  
  # 기존 태그 학습 설정
  learn_from_existing: true     # 기존 vault 태그 패턴 학습 여부
  similarity_threshold_for_learning: 0.7  # 태그 학습 유사도 임계값
  ignore_existing_tags: true    # 기존 태그 무시하고 재생성
  
  # 태그 정규화 규칙
  force_lowercase: true         # 소문자 강제 변환
  replace_spaces_with_hyphens: true  # 공백을 하이픈으로 변환
  remove_development_prefix: true    # development/ prefix 제거
  exclude_directory_based_tags: true # 디렉토리 기반 태그 제외
  use_hierarchical_separator: "/"   # 계층 구분자
  
  # 배치 처리 설정
  enable_recursive: true        # 재귀 처리 기본값
  default_batch_size: 10        # 기본 배치 크기
  show_progress: true           # 진행률 표시
  enable_dry_run: false         # 드라이런 모드 기본값
  
  # 품질 검증 설정
  validate_tag_consistency: true    # 태그 일관성 검증
  min_confidence_score: 0.5         # 최소 신뢰도 점수
  enable_tag_deduplication: true    # 태그 중복 제거
  
  # 성능 최적화
  cache_semantic_analysis: true     # 의미 분석 결과 캐싱
  parallel_processing: true         # 병렬 처리 활성화
  memory_limit_mb: 2048            # 메모리 제한 (MB)
